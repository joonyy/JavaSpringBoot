<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User List</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="/post.css">
</head>
<body>
<h1>Post List</h1>
<a href="/posts/new" class="btn">게시글 작성하기</a>
<table id="postTable">
    <thead>
    <tr>
        <th>No</th>
        <th>Title</th>
        <th>writer</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetchPosts();
    });

    function fetchPosts() {
        axios.get('/api/posts')
            .then(function (response) {
                const posts = response.data;
                console.log(posts);
                const tbody = document.querySelector('#postTable tbody');
                tbody.innerHTML = '';
                posts.forEach(function(post) {
                    const row = `
                    <tr>
                        <td>${post.id}</td>
                        <td>${post.title}</td>
                        <td>${post.writer}</td>
                        <td class="action-buttons">
                            <a href="/posts/${post.id}/edit" class="btn">수정</a>
                            <button onclick="deletePost(${post.id})" class="btn btn-danger">삭제</button>
                            <button onclick="reportPost(${post.id})" class="btn btn-report">신고</button>
                        </td>
                    </tr>
                `;
                    tbody.innerHTML += row;
                });
            })
            .catch(function (error) {
                console.error('Error:', error);
            });
    }

    function reportPost(id){
        if(confirm('정말로 신고하시겠습니까?')) {
            axios.post('/api/posts/' + id)
                .then(function (response) {
                    fetchPosts();
                })
                .catch(function (error) {
                    console.error('Error:', error);
                });
        }
    }

    function deletePost(id) {
        if (confirm('정말로 삭제하시겠습니까?')) {
            axios.delete('/api/posts/' + id)
                .then(function (response) {
                    fetchPosts();
                })
                .catch(function (error) {
                    console.error('Error:', error);
                });
        }
    }
</script>
</body>
</html>